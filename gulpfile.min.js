var gulp=require("gulp"),browserSync=require("browser-sync"),sass=require("gulp-sass"),plumber=require("gulp-plumber"),csscomb=require("gulp-csscomb"),notify=require("gulp-notify"),autoprefixer=require("gulp-autoprefixer"),uglify=require("gulp-uglify"),rename=require("gulp-rename"),watch=require("gulp-watch"),changed=require("gulp-changed"),cache=require("gulp-cached"),destDir="docs/",assetsDir="base/common/";gulp.task("browser-sync",function(){browserSync({server:{baseDir:destDir}})}),gulp.task("sass",function(){return gulp.src(["resource/"+assetsDir+"sass/**/*.scss"]).pipe(plumber({errorHandler:notify.onError("Error: <%= error.message %>")})).pipe(sass()).pipe(autoprefixer({browsers:["last 2 versions","Android 3","ie 9"]})).pipe(csscomb()).pipe(gulp.dest("resource/"+assetsDir+"css/"))}),gulp.task("css",function(){return gulp.src("resource/**/*.css").pipe(cache("css-cache")).pipe(gulp.dest(destDir)).pipe(browserSync.stream())}),gulp.task("jsmin",function(){gulp.src(["resource/"+assetsDir+"js/**/*.js","!resource/"+assetsDir+"js/**/*.min.js"]).pipe(plumber()).pipe(changed(destDir+assetsDir+"js/")).pipe(uglify({preserveComments:"some"})).pipe(rename({suffix:".min"})).pipe(gulp.dest("resource/"+assetsDir+"js/"))}),gulp.task("js",function(){return gulp.src("resource/**/*.js").pipe(cache("js-cache")).pipe(gulp.dest(destDir)).pipe(browserSync.stream())}),gulp.task("copyResource",function(){return gulp.src(["resource/**/*","!resource/"+assetsDir+"sass/","!resource/"+assetsDir+"sass/*.scss"]).pipe(cache("resource-cache")).pipe(gulp.dest(destDir)).pipe(browserSync.stream())}),gulp.task("default",["browser-sync","copyResource","sass","jsmin"],function(){watch(["resource/**/*.+(jpg|jpeg|gif|png|html|php)"],function(){gulp.start(["copyResource"])}),watch(["resource/**/*.scss"],function(){gulp.start(["sass"])}),watch(["resource/**/*.css"],function(){gulp.start(["css"])}),watch(["resource/**/*.js"],function(){gulp.start(["jsmin"])}),watch(["resource/**/*.min.js"],function(){gulp.start(["js"])})});
